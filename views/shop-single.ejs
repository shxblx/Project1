<!DOCTYPE html>
<html lang="en">

<head>
  <title>ShopMax &mdash; Colorlib e-Commerce Template</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,400,700">
  <link rel="stylesheet" href="fonts/icomoon/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/magnific-popup.css">
  <link rel="stylesheet" href="css/jquery-ui.css">
  <link rel="stylesheet" href="css/owl.carousel.min.css">
  <link rel="stylesheet" href="css/owl.theme.default.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">

  <!-- Add these links to your HTML head section -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


  <link rel="stylesheet" href="css/aos.css">

  <link rel="stylesheet" href="css/style.css">

  <style>
    .carousel-inner img {
      width: 100%;
      /* Ensure the image takes 100% width of its container */
      height: auto;
      /* Maintain aspect ratio */
    }

    .zoom-in {
      overflow: hidden;
      /* Hide overflow content outside the image section */
    }

    .carousel-control-prev,
    .carousel-control-next {
      width: auto;
      /* Adjust the width of carousel controls */
    }
  </style>

  <style>
    :root {
      --primary-color: #ee4266;
      /* Define your custom primary color */
    }

    .btn-primary,
    .btn-primary:hover,
    .btn-primary:active,
    .btn-primary:focus {
      background-color: var(--primary-color);
      /* Apply custom primary color to Bootstrap buttons */
      border-color: var(--primary-color);
    }

    .btn-outline-primary,
    .btn-outline-primary:hover,
    .btn-outline-primary:active,
    .btn-outline-primary:focus {
      color: var(--primary-color);
      /* Apply custom primary color to Bootstrap outline buttons */
      border-color: var(--primary-color);
    }

    /* You can add more styles for other elements as needed */
  </style>

  <style>
    .thumbnail-image {
      width: 100px;
      /* Set the desired width for the thumbnails */
      height: auto;
      /* Maintain the aspect ratio */
      cursor: pointer;
      /* Show pointer cursor on hover for interaction */
      margin: 0;
      /* Remove margin to minimize the spacing */
      border: 1px solid #ddd;
      /* Add a border for better visibility */
      border-radius: 5px;
      /* Optional: Add rounded corners */
    }

    .thumbnail-image:hover {
      border-color: #333;
      /* Change border color on hover for a highlight effect */
    }
  </style>




</head>

<body>

  <div class="site-wrap">


    <div class="site-navbar bg-white py-2">

      <div class="search-wrap">
        <div class="container">
          <a href="#" class="search-close js-search-close"><span class="icon-close2"></span></a>
          <form action="#" method="post">
            <input type="text" class="form-control" placeholder="Search keyword and hit enter...">
          </form>
        </div>
      </div>

      <div class="container">
        <div class="d-flex align-items-center justify-content-between">
          <div class="logo">
            <div class="site-logo">
              <a href="/" class="js-logo-clone">Groove Style</a>
            </div>
          </div>
          <div class="main-nav d-none d-lg-block">
            <nav class="site-navigation text-right text-md-center" role="navigation">
              <ul class="site-menu js-clone-nav d-none d-lg-block">
                <li>
                  <a href="/home">Home</a>
                </li>
                <li class="active"><a href="/shop">Shop</a></li>
                <li><a href="/about">About Us</a></li>
                <li><a href="/contact">Contact</a></li>
              </ul>
            </nav>
          </div>
          <div class="icons">
            <a href="#" class="icons-btn d-inline-block js-search-open"><span class="icon-search"></span></a>
            <a href="#" class="icons-btn d-inline-block"><span class="icon-heart-o"></span></a>
            <a href="/cart" class="icons-btn d-inline-block bag">
              <span class="icon-shopping-bag"></span>
              <span class="number">2</span>
            </a>
            <li class="icons-btn d-inline-block">
              <a href=""><span><i id="pro-icon" class="fa-solid fa-user"></i></span></a>
              <ul class="dropdown">
                <% if (locals.user) { %>
                  <li><a class="dropdown-item bg-light" href="/profile">
                      <%=locals.user.username%>
                    </a></li>
                  <li><a href="/userLogout" class="dropdown-item bg-light" href="/logout">Logout</a></li>


                  <% } else { %>
                    <li><a class="dropdown-item bg-light" href="/login">Login</a></li>
                    <li><a class="dropdown-item bg-light" href="/signup">SignUp</a></li>
                    <li><a href="/admin" class="dropdown-item bg-light">Admin</a></li>
                    <% } %>
              </ul>
            </li>
          </div>
        </div>
      </div>
    </div>

    <% if (productsId.length> 0) { %>
      <% for (let i=0; i < productsId.length; i++) { %>

        <div class="bg-light py-3">
          <div class="container">
            <div class="row">
              <div class="col-md-12 mb-0-primary"><a style="color: #ee4266;" href="/home">Home</a> <span
                  class="mx-2 mb-0">/</span> <a style="color: #ee4266;" href="/shop">Shop</a> <span
                  class="mx-2 mb-0">/</span> <strong class="text-black">
                  <%=productsId[i].name%>
                </strong></div>
            </div>
          </div>
        </div>

        <div class="site-section">
          <div class="container">
            <div class="row">
              <!-- Thumbnails Section -->

              <div class="row" style="flex-direction: column; margin-left: -5px; margin-right: -5px;">
                <% for (let j=0; j < productsId[i].image.length; j++) { %>
                  <div class="">
                    <img src="/myImages/<%= productsId[i].image[j] %>" alt="Thumbnail <%= j + 1 %>"
                      class="img-fluid thumbnail-image" onclick="changeMainImage('<%= productsId[i].image[j] %>')" />
                  </div>
                  <% } %>
              </div>


              <div class="col-md-6">
                <div class="item-entry">
                  <div id="productCarousel<%= i %>" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                      <% for (let j=0; j < productsId[i].image.length; j++) { %>
                        <div class="carousel-item <%= j === 0 ? 'active' : '' %>">
                          <div class="zoom-in">
                            <img src="/myImages/<%= productsId[i].image[j] %>" alt="Image <%= j + 1 %>"
                              class="img-fluid mb-2">
                          </div>
                        </div>
                        <% } %>
                    </div>
                    <a class="carousel-control-prev" href="#productCarousel<%= i %>" role="button" data-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#productCarousel<%= i %>" role="button" data-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="sr-only">Next</span>
                    </a>
                  </div>
                </div>
              </div>


              <div class="col-md-3">
                <!-- Your product details as you have them -->
                <h2 class="text-black">
                  <%= productsId[i].name %>
                </h2>
                <p>
                  <%= productsId[i].description %>
                </p>

                <p style="color:black;"><strong class="text h4">₹<%= productsId[i].price %></strong></p>
                <div class="mb-5">
                  <div class="input-group mb-3" style="max-width: 120px;">
                      <div class="input-group-prepend">
                          <button class="btn btn-outline-primary js-btn-minus" type="button" onclick="decreaseQuantity()">−</button>
                      </div>
                      <input id="quantityInput" data-quantity="<%= productsId[i].quantity %>" type="text"
                          class="form-control text-center" value="0" placeholder="" aria-label="Example text with button addon"
                          aria-describedby="button-addon1">
                      <div class="input-group-append">
                          <button class="btn btn-outline-primary js-btn-plus" type="button" onclick="increaseQuantity()">+</button>
                      </div>
                  </div>
                  <p>Items Left: <%= productsId[i].quantity %></p>
                  <p>
                      <button class="buy-now btn btn-sm height-auto px-4 py-3 btn-primary" data-productId="<%= productsId[i]._id %>"
                          id="addToCartBtn" onclick="addToCart(this)">
                          Add To Cart
                      </button>
                  </p>
              </div>
              </div>

            </div>
          </div>
        </div>


        <div class="site-section block-3 site-blocks-2">
          <div class="container">
            <div class="row justify-content-center">
              <div class="col-md-7 site-section-heading text-center pt-4">
                <h2>Featured Products</h2>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12 block-3">
                <div class="nonloop-block-3 owl-carousel">
                  <!-- Featured Products Carousel -->
                  <!-- Add your featured product items here -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <% } %>
          <% } %>


            <footer class="site-footer custom-border-top">
              <div class="container">
                <div class="row">
                  <div class="col-md-6 col-lg-3 mb-4 mb-lg-0">
                    <h3 class="footer-heading mb-4">Promo</h3>
                    <a href="#" class="block-6">
                      <img src="images/about_1.jpg" alt="Image placeholder" class="img-fluid rounded mb-4">
                      <h3 class="font-weight-light  mb-0">Finding Your Perfect Shirts This Summer</h3>
                      <p>Promo from July 15 &mdash; 25, 2019</p>
                    </a>
                  </div>
                  <div class="col-lg-5 ml-auto mb-5 mb-lg-0">
                    <div class="row">
                      <div class="col-md-12">
                        <h3 class="footer-heading mb-4">Quick Links</h3>
                      </div>
                      <div class="col-md-6 col-lg-4">
                        <ul class="list-unstyled">
                          <li><a href="#">Sell online</a></li>
                          <li><a href="#">Features</a></li>
                          <li><a href="#">Shopping cart</a></li>
                          <li><a href="#">Store builder</a></li>
                        </ul>
                      </div>
                      <div class="col-md-6 col-lg-4">
                        <ul class="list-unstyled">
                          <li><a href="#">Mobile commerce</a></li>
                          <li><a href="#">Dropshipping</a></li>
                          <li><a href="#">Website development</a></li>
                        </ul>
                      </div>
                      <div class="col-md-6 col-lg-4">
                        <ul class="list-unstyled">
                          <li><a href="#">Point of sale</a></li>
                          <li><a href="#">Hardware</a></li>
                          <li><a href="#">Software</a></li>
                        </ul>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6 col-lg-3">
                    <div class="block-5 mb-5">
                      <h3 class="footer-heading mb-4">Contact Info</h3>
                      <ul class="list-unstyled">
                        <li class="address">203 Fake St. Mountain View, San Francisco, California, USA</li>
                        <li class="phone"><a href="tel://23923929210">+2 392 3929 210</a></li>
                        <li class="email">emailaddress@domain.com</li>
                      </ul>
                    </div>

                    <div class="block-7">
                      <form action="#" method="post">
                        <label for="email_subscribe" class="footer-heading">Subscribe</label>
                        <div class="form-group">
                          <input type="text" class="form-control py-4" id="email_subscribe" placeholder="Email">
                          <input type="submit" class="btn btn-sm btn-primary" value="Send">
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
                <div class="row pt-5 mt-5 text-center">
                  <div class="col-md-12">
                    <p>
                      <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                      Copyright &copy;
                      <script>document.write(new Date().getFullYear());</script> All rights reserved | This template is
                      made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com"
                        target="_blank" class="text-primary">Colorlib</a>
                      <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </p>
                  </div>

                </div>
              </div>
            </footer>
  </div>

  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="js/jquery-ui.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.magnific-popup.min.js"></script>
  <script src="js/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

  <script src="js/main.js"></script>

  <script>
    function decreaseQuantity() {
        const quantityInput = document.getElementById('quantityInput');
        const addToCartButton = document.getElementById('addToCartBtn');
        let currentQuantity = parseInt(quantityInput.value, 10);

        

        enableAddToCartButton();

        enableIncreaseButton();
    }

    function increaseQuantity() {
        const quantityInput = document.getElementById('quantityInput');
        const addToCartButton = document.getElementById('addToCartBtn');
        const increaseButton = document.querySelector('.js-btn-plus');

        let currentQuantity = parseInt(quantityInput.value, 10);
        let maxQuantity = parseInt(quantityInput.getAttribute('data-quantity'), 10);

        if (currentQuantity < maxQuantity) {
            enableAddToCartButton();
        } else {
            Swal.fire({
                icon: 'warning',
                title: 'Item Limit Exceeded',
                text: 'You cannot add more items than available',
                confirmButtonText: 'OK',
            });

            addToCartButton.disabled = true;
        }

        if (currentQuantity === maxQuantity) {
            increaseButton.disabled = true;
        }
    }

    function enableAddToCartButton() {
        const addToCartButton = document.getElementById('addToCartBtn');
        addToCartButton.disabled = false;
    }

    function enableIncreaseButton() {
        const increaseButton = document.querySelector('.js-btn-plus');
        increaseButton.disabled = false;
    }



    function addToCart(button) {
      const product_id = button.getAttribute('data-productId');
      const quantity = document.getElementById('quantityInput').value;

      const data = {
        product_id,
        quantity
      };

      fetch('/addToCart', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            Swal.fire({
              icon: 'success',
              title: 'Success!',
              text: 'Product added to cart successfully!',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Go to Cart',
              cancelButtonText: 'Continue Shopping',
            }).then((result) => {
              if (result.isConfirmed) {
                // Redirect to the cart page or navigate to the cart
                window.location.href = '/cart';
              } else {
                // Continue shopping
                // You can add any additional action here if needed
              }
            });
          }
         else if(result.outOfStock){
          Swal.fire({
              icon: 'error',
              title: 'Cannot Add Product!',
              text: 'Product Out of Stock',
            });

         } else if(result.zeroQuantity){
          Swal.fire({
              icon: 'error',
              title: 'Cannot Add Product!',
              text: 'Give some Quantity',
            });
         } else {
            Swal.fire({
              icon: 'error',
              title: 'Error!',
              text: 'Failed to add product to cart. Please try again.',
            });
          }
        })
        .catch(error => {
          console.error('Error:', error);
          Swal.fire({
            icon: 'error',
            title: 'Error!',
            text: 'You are not logged in.',
          });
        });
    }

  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Image Zoom functions go here
      function zoomIn(event, zoomFactor) {
        const image = event.target;
        image.style.transform = `scale(${zoomFactor})`;
      }

      function resetZoom(event) {
        const image = event.target;
        image.style.transform = 'scale(1)';
      }

      const sProductCarousel = document.querySelector('.carousel');
      const productImages = sProductCarousel.querySelectorAll('.zoom-in img');

      productImages.forEach(img => {
        img.addEventListener('mouseover', function () {
          img.style.transform = 'scale(2.0)';
          img.style.transition = 'transform 0.3s ease';
        });

        img.addEventListener('mousemove', function (e) {
          const boundingBox = img.getBoundingClientRect();
          const offsetX = (e.clientX - boundingBox.left) / boundingBox.width;
          const offsetY = (e.clientY - boundingBox.top) / boundingBox.height;

          img.style.transformOrigin = `${offsetX * 100}% ${offsetY * 100}%`;
        });

        img.addEventListener('mouseleave', function () {
          img.style.transform = 'scale(1)';
        });

        img.addEventListener('mousemove', function (e) {
          zoomIn(e, 1.5);
        });

        img.addEventListener('mouseout', resetZoom);
      });
    });
  </script>

  <% for (let i=0; i < productsId.length; i++) { %>
    <script>
      function changeMainImage(imageSrc) {
        // Change the source of the main image
        document.querySelector('.item-entry .carousel-inner .active img').src = '/myImages/' + imageSrc;

        // Update the carousel to reflect the change
        $('#productCarousel<%= i %>').carousel(0);
      }
    </script>
    <% } %>


</body>

</html>